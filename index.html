<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GranTES - Smart Subsidy Management System</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="nemsulogo.png" alt="NEMSULOGO" width="90">
                <span> GranTES</span>
            </div>
            <div class="nav-menu">
                <a href="#" class="nav-link" onclick="showHome()">Home</a>
                <a href="#" class="nav-link" onclick="showLogin()">Login</a>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <div class="main-container">
        <!-- Home Section -->
        <section id="home" class="section active">
            <!-- Enhanced Hero Section -->
            <div class="hero-section">
                <div class="hero-content">
                    <div class="hero-text">
                        <div class="hero-badge">
                            <i class="fas fa-graduation-cap"></i>
                            <span>NEMSU GranTES Program</span>
                        </div>
                        <h1 class="hero-title">
                            Smart Subsidy Management System
                            <span class="hero-subtitle">Empowering Students Through Technology</span>
                        </h1>
                        <p class="hero-description">
                            Streamline your educational subsidy applications with our comprehensive management platform. 
                            Access financial assistance, track applications, and stay connected with the administration.
                        </p>
                        <div class="hero-actions">
                            <a href="https://docs.google.com/forms/d/e/1FAIpQLSejN9ltqtPy2eiC3TtPXPBl0bGLwwb6UjfbT5YITEVl8BiOcA/viewform?usp=header" target="_blank" class="btn btn-primary btn-large">
                                <i class="fas fa-paper-plane"></i>
                                Apply Now
                            </a>
                            <button class="btn btn-outline btn-large" onclick="showLogin()">
                                <i class="fas fa-sign-in-alt"></i>
                                Student Login
                            </button>
                        </div>
                    </div>
                    <div class="hero-visual">
                        <div class="hero-image-container">
                            <img src="nemsulogo.png" alt="NEMSU Logo" class="hero-logo">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Quick Links Section -->
            <div class="quick-links-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-link"></i>
                        <h3>Quick Access</h3>
                    </div>
                    <p class="section-subtitle">Essential links and resources for students</p>
                </div>
                <div class="quick-links-grid">
                    <a href="https://ched.gov.ph/" target="_blank" class="quick-link-card">
                        <div class="card-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="card-content">
                            <h4>CHED Website</h4>
                            <p>Official Commission on Higher Education portal</p>
                        </div>
                        <div class="card-arrow">
                            <i class="fas fa-external-link-alt"></i>
                        </div>
                    </a>
                    <button class="quick-link-card" onclick="showGrantesList()">
                        <div class="card-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="card-content">
                            <h4>GranTES Directory</h4>
                            <p>View all registered GranTES students</p>
                        </div>
                        <div class="card-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>
                    </button>
                    
                </div>
            </div>

            <!-- Enhanced Announcements Section -->
            <div class="announcements-section">
                <div class="section-header">
                    <div class="section-title">
                        <i class="fas fa-bullhorn"></i>
                        <h3>Latest Announcements</h3>
                    </div>
                    <p class="section-subtitle">Stay updated with important news and updates</p>
                </div>
                <div class="announcements-container">
                    <div class="posts-feed" id="homeFeed">
                        <!-- Home posts will render here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Section -->
        <section id="login" class="section">
            <div class="auth-container">
                <div class="auth-header">
                    <h2>Login</h2>
                    <p>Access your account</p>
                </div>
                <form class="auth-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginRole">Login as:</label>
                        <select id="loginRole" required onchange="handleRoleChange()">
                            <option value="">Select Role</option>
                            <option value="student">Student</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group" id="loginEmailGroup">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group" id="loginAwardNumberGroup" style="display: none;">
                        <label for="loginAwardNumber">Award Number:</label>
                        <input type="text" id="loginAwardNumber">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Login</button>
                </form>
            </div>
        </section>

        <!-- Registration Section -->
        <section id="register" class="section">
            <div class="auth-container">
                <div class="auth-header">
                    <h2>Student Registration</h2>
                    <p>Create your account to apply for subsidies</p>
                </div>
                <form class="auth-form" onsubmit="handleRegister(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name:</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name:</label>
                            <input type="text" id="lastName" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="studentId">Student ID:</label>
                        <input type="text" id="studentId" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email:</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password:</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password:</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="department">Department:</label>
                        <select id="department" required>
                            <option value="">Select Department</option>
                            <option value="Department of Computer Studies">Department of Computer Studies</option>
                            <option value="Department of Business and Management">Department of Business and Management</option>
                            <option value="Department of Industrial Technology">Department of Industrial Technology</option>
                            <option value="Department of General Teacher Training">Department of General Teacher Training</option>
                            <option value="College of Criminal Justice Education">College of Criminal Justice Education</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="course">Course:</label>
                            <input type="text" id="course" required>
                        </div>
                        <div class="form-group">
                            <label for="year">Year Level:</label>
                            <select id="year" required>
                                <option value="">Select Year</option>
                                <option value="1st">1st Year</option>
                                <option value="2nd">2nd Year</option>
                                <option value="3rd">3rd Year</option>
                                <option value="4th">4th Year</option>
                                
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Register</button>
                    <p class="auth-switch">Already have an account? <a href="#" onclick="showLogin()">Login here</a></p>
                </form>
            </div>
        </section>

        <!-- Student Homepage -->
        <section id="student-homepage" class="section">
            <div class="admin-layout">
                <!-- Left Sidebar -->
                <div class="admin-sidebar">
                    <h2>Student Portal</h2>
                    <div class="sidebar-stats">
                        <div class="sidebar-stat-card" onclick="openStudentMessages()" style="cursor: pointer;">
                            <i class="fas fa-bell"></i>
                            <div class="stat-info">
                                <h3>Notifications</h3>
                                <p id="studentNotificationCount">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="profile-card" style="margin-top: 1rem;">
                        <div class="profile-card-header" onclick="showStudentProfile()" style="cursor: pointer;">
                            <div class="profile-avatar">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="profile-header-text">
                                <span class="profile-label">Profile</span>
                            </div>
                            <span class="status-badge" id="profileStatus"></span>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="admin-main-content">
                    <div class="admin-content-header">
                        <button class="admin-homepage-btn" onclick="showStudentTab('homepage')">
                            <i class="fas fa-home"></i>
                            Student Homepage
                        </button>
                            <div class="user-info">
                                <span id="studentName"></span>
                                <button class="btn btn-secondary" onclick="logout()">Logout</button>
                            </div>
                    </div>

                    <div class="admin-content-body">
                        <!-- Student Homepage Content -->
                        <div id="student-homepage-content" class="admin-homepage-content">
                            <!-- Posts Feed -->
                            <div class="posts-feed" id="studentPostsFeed">
                                <div class="welcome-message">
                                    <h3>Welcome to the Student Portal</h3>
                                    <p>Stay updated with announcements and communicate with the administration team.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="admin-nav-tabs" style="display:none;">
                            <button class="nav-tab-btn" onclick="showStudentTab('announcements')">Announcements</button>
                            <button class="nav-tab-btn" onclick="showStudentTab('messages')">Messages</button>
                        </div>

                        <!-- Tab Content (hidden by default) -->
                        <div class="tab-content" style="display: none;">
                            <!-- Announcements Tab -->
                            <div id="announcements-tab" class="tab-panel active">
                                <div class="announcements-section">
                                    <h3>Announcements & Posts</h3>
                                    <p>Stay updated with the latest news and announcements from the administration</p>
                                    <div class="posts-feed" id="studentAnnouncementsFeed">
                                        <!-- Admin posts will be loaded here -->
                                    </div>
                                </div>
                            </div>


                            <!-- Messages Tab -->
                            <div id="messages-tab" class="tab-panel">
                                <div class="messages-section">
                                    <h3>Direct Messages</h3>
                                    <p>Chat directly with the administration team</p>
                                    <div class="messenger-container">
                                        <div class="messenger-chat" id="studentMessengerChat">
                                            <div class="chat-messages" id="studentChatMessages">
                                                <!-- Chat messages will be loaded here -->
                                            </div>
                                            <div class="chat-input-container">
                                                <div class="chat-input-wrapper">
                                                    <button type="button" class="chat-attach-btn" onclick="triggerFileUpload()" title="Attach file">
                                                        <i class="fas fa-paperclip"></i>
                                                    </button>
                                                    <input type="file" id="chatFileInput" style="display: none" accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                                                    <input type="text" id="chatMessageInput" placeholder="Type a message..." onkeypress="handleChatKeyPress(event)">
                                                    <button class="chat-send-btn" onclick="sendMessage()" title="Send message">
                                                        <i class="fas fa-paper-plane"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Profile Panel (shown programmatically) -->
                            <div id="profile-tab" class="tab-panel">
                                <div class="profile-card">
                                    <div class="profile-card-header">
                                        <div class="profile-avatar">
                                            <i class="fas fa-user-graduate"></i>
                                        </div>
                                        <div class="profile-header-text">
                                            <h3 id="profileNameMain"></h3>
                                            <div class="profile-meta">
                                                <span id="profileEmailMain"></span>
                                                <span class="dot">•</span>
                                                <span id="profileStudentIdMain"></span>
                                            </div>
                                        </div>
                                        <span class="status-badge" id="profileStatusMain"></span>
                                    </div>
                                    <div class="profile-info-grid">
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-building-columns"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">Department</div>
                                                <div class="tile-value" id="profileDepartmentMain"></div>
                                            </div>
                                        </div>
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-location-dot"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">From</div>
                                                <div class="tile-value" id="profilePlaceMain"></div>
                                            </div>
                                        </div>
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-book"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">Course</div>
                                                <div class="tile-value" id="profileCourseMain"></div>
                                            </div>
                                        </div>
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-layer-group"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">Year Level</div>
                                                <div class="tile-value" id="profileYearMain"></div>
                                            </div>
                                        </div>
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-id-card"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">Award Number</div>
                                                <div class="tile-value" id="profileAwardNumberMain"></div>
                                            </div>
                                        </div>
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-people-group"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">Indigenous People</div>
                                                <div class="tile-value" id="profileIndigenousMain"></div>
                                            </div>
                                        </div>
                                        <div class="profile-tile">
                                            <div class="tile-icon"><i class="fas fa-wheelchair"></i></div>
                                            <div class="tile-content">
                                                <div class="tile-label">PWD's</div>
                                                <div class="tile-value" id="profilePwdMain"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Dashboard -->
        <section id="admin-dashboard" class="section">
            <div class="admin-layout">
                <!-- Left Sidebar -->
                <div class="admin-sidebar">
                    <h2>Admin Dashboard</h2>
                    <div class="sidebar-stats">
                        <div class="sidebar-stat-card">
                            <i class="fas fa-users"></i>
                            <div class="stat-info">
                                <h3>Total Students</h3>
                                <p id="totalStudents">0</p>
                            </div>
                        </div>
                        <div class="sidebar-stat-card">
                            <i class="fas fa-check-circle"></i>
                            <div class="stat-info">
                                <h3>INDIGENOUS PEOPLE</h3>
                                <p id="totalApproved">0</p>
                            </div>
                        </div>
                        <div class="sidebar-stat-card">
                            <i class="fas fa-clock"></i>
                            <div class="stat-info">
                                <h3>PWD's</h3>
                                <p id="totalPending">0</p>
                            </div>
                        </div>
                        <div class="sidebar-stat-card" onclick="viewArchived()" style="cursor:pointer;">
                            <i class="fas fa-archive"></i>
                            <div class="stat-info">
                                <h3>Archived</h3>
                                <p id="totalArchived">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="admin-main-content">
                    <div class="admin-content-header">
                        <button class="admin-homepage-btn" onclick="showAdminTab('homepage')">
                            <i class="fas fa-home"></i>
                            Admin Homepage
                        </button>
                        <div class="user-info">
                            <span>Administrator</span>
                            <button class="btn btn-secondary" onclick="logout()">Logout</button>
                        </div>
                    </div>

                    <div class="admin-content-body">
                        <!-- Admin Homepage Content -->
                        <div id="admin-homepage" class="admin-homepage-content">
                            <!-- Admin Quick Actions -->
                            <div class="admin-quick-actions">
                                <div class="register-student-container">
                                    <button class="quick-action-btn register-student" onclick="openStudentRegistrationModal()">
                                        <i class="fas fa-user-plus"></i>
                                        <span>Register Single Student</span>
                                    </button>
                                    <div class="register-student-dropdown">
                                        <button class="quick-action-btn register-student-bulk" onclick="openBulkRegistrationModal()">
                                            <i class="fas fa-file-excel"></i>
                                            <span>Bulk Register from Excel</span>
                                        </button>
                                    </div>
                                </div>
                                <!-- View Applications removed -->
                                <button class="quick-action-btn manage-students" onclick="openManageStudents()">
                                    <i class="fas fa-users"></i>
                                    <span>Manage Students</span>
                                </button>
                            </div>

                            <!-- Post Creation Interface -->
                            <div class="post-creation-container">
                                <div class="post-creation-header">
                                    <div class="admin-profile-pic">
                                        <i class="fas fa-user-shield"></i>
                                    </div>
                                    <div class="post-input-container">
                                        <input type="text" id="postInput" placeholder="What's on your mind, Administrator?" class="post-input" onkeypress="handlePostKeyPress(event)">
                                        <div class="post-audience-selector">
                                            <select id="postAudience" class="audience-select">
                                                <option value="students">GranTES Students</option>
                                                <option value="home">Home Page</option>
                                            </select>
                                            <select id="postCourse" class="course-select" style="display: none;">
                                                <option value="">Select Course</option>
                                                <option value="BSIT">BSIT</option>
                                                <option value="BSCS">BSCS</option>
                                                <option value="BSBA">BSBA</option>
                                                <option value="BSEd">BSEd</option>
                                                <option value="BSN">BSN</option>
                                            </select>
                                            <select id="postLayout" class="audience-select">
                                                <option value="image-left">Image Left</option>
                                                <option value="image-right">Image Right</option>
                                            </select>
                                        </div>
                                        <!-- Image preview and hidden file input for post -->
                                        <div class="post-image-preview" id="postImagePreview" style="display:none;">
                                            <img id="postImagePreviewImg" alt="Selected image preview">
                                            <span class="post-image-count-badge" id="postImageCount" style="display:none;">+0</span>
                                            <button type="button" class="clear-image-btn" onclick="clearPostImage()" title="Remove image"><i class="fas fa-times"></i></button>
                                        </div>
                                        <input type="file" id="postImageInput" accept="image/*" multiple style="display:none" onchange="handlePostImagesSelected(event)">
                                    </div>
                                </div>
                                <div class="post-separator"></div>
                                <div class="post-actions">
                                    <button class="post-action-btn live-video" onclick="createPost('live')">
                                        <i class="fas fa-video"></i>
                                        <span>Live video</span>
                                    </button>
                                    <button class="post-action-btn photo-video" onclick="triggerPostImageUpload()">
                                        <i class="fas fa-images"></i>
                                        <span>Photo/video</span>
                                    </button>
                                    <button class="post-action-btn feeling" onclick="createPost('feeling')">
                                        <i class="fas fa-smile"></i>
                                        <span>Feeling/activity</span>
                                    </button>
                                    <button class="post-action-btn publish" onclick="publishPost()">
                                        <i class="fas fa-paper-plane"></i>
                                        <span>Publish</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Posts Feed -->
                            <div class="posts-feed" id="postsFeed">
                                <div class="welcome-message">
                                    <h3>Welcome to the Admin Dashboard</h3>
                                    <p>Manage student applications, view reports, and configure system settings from this central location.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="admin-nav-tabs">
                            <!-- Applications tab removed -->
                            <button class="nav-tab-btn" onclick="showAdminTab('students')">Students</button>
                            <button class="nav-tab-btn" onclick="showAdminTab('reports')">Reports</button>
                            <button class="nav-tab-btn active" onclick="showAdminTab('settings')">Settings</button>
                        </div>

                        <!-- Tab Content (hidden by default) -->
                        <div class="tab-content" style="display: none;">
                    <!-- Applications Tab removed -->

                    <!-- Students Tab -->
                    <div id="students-tab" class="tab-panel">
                        <div class="students-list">
                            <h3>Student Records</h3>
                            <div class="filter-bar">
                                <input type="text" id="searchStudentRecords" placeholder="Search students..." onkeyup="searchStudents()">
                            </div>
                            <div id="studentsContainer">
                                <p class="no-data">No students found.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="reports-tab" class="tab-panel">
                        <div class="reports-section">
                            <h3>Reports & Analytics</h3>
                            <div class="report-cards">
                                <div class="report-card">
                                    <h4>Department Analysis</h4>
                                    <canvas id="departmentChart" width="400" height="200"></canvas>
                                    <div id="departmentSummary" class="report-summary"></div>
                                </div>
                                <div class="report-card">
                                    <h4>From Analysis</h4>
                                    <canvas id="placeChart" width="400" height="200"></canvas>
                                    <div id="placeSummary" class="report-summary"></div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="settings-tab" class="tab-panel">
                        <div class="settings-section">
                            <h3>System Settings</h3>
                            <div class="settings-form">
                                <div class="form-group">
                                    <label for="adminEmailSetting">Admin Email:</label>
                                    <input type="email" id="adminEmailSetting" placeholder="Enter admin email">
                                </div>
                                <div class="form-group">
                                    <label for="adminPasswordSetting">Admin Password:</label>
                                    <input type="password" id="adminPasswordSetting" placeholder="Enter new password">
                                </div>
                                <div class="form-group">
                                    <label for="adminPasswordConfirmSetting">Confirm Password:</label>
                                    <input type="password" id="adminPasswordConfirmSetting" placeholder="Confirm new password">
                                </div>
                                <div class="form-group">
                                    <h4 style="margin-bottom:0.5rem;">Update Student Credentials</h4>
                                    <div class="form-group" style="margin-top:0.5rem;">
                                        <label for="adminStudentLookup">Student Identifier (Award No. / Student ID / Email)</label>
                                        <input type="text" id="adminStudentLookup" placeholder="Type to search... e.g., AW2025001, STU0001, name or email">
                                        <input type="hidden" id="adminSelectedStudentId">
                                        <div id="adminStudentSearchResults" class="admin-search-results"></div>
                                        <div id="adminSelectedStudentSummary" class="selected-student-summary" style="display:none;">
                                            <div class="summary-main">
                                                <div class="summary-name" id="adminSelectedStudentName"></div>
                                                <div class="summary-meta" id="adminSelectedStudentMeta"></div>
                                            </div>
                                            <button type="button" class="btn btn-secondary btn-sm" onclick="clearSelectedStudent()">Clear</button>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="adminStudentNewAward">New Award Number</label>
                                            <input type="text" id="adminStudentNewAward" placeholder="Leave blank to keep current" disabled>
                                            <div id="adminAwardValidation" class="input-hint"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminStudentNewPassword">New Password</label>
                                            <input type="password" id="adminStudentNewPassword" placeholder="Leave blank to keep current" disabled>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="adminStudentNewPasswordConfirm">Confirm New Password</label>
                                        <input type="password" id="adminStudentNewPasswordConfirm" placeholder="Confirm new password" disabled>
                                        <div class="form-row" style="margin-top: 0.5rem;">
                                            <label style="display:flex; align-items:center; gap:8px;">
                                                <input type="checkbox" id="adminShowPasswords" disabled>
                                                <span>Show passwords</span>
                                            </label>
                                        </div>
                                        <div id="adminPasswordValidation" class="input-hint"></div>
                                    </div>
                                    <button id="adminUpdateStudentBtn" class="btn btn-primary" onclick="updateStudentCredentialsFromSettings()" disabled>Update Student Account</button>
                                </div>
                                <button class="btn btn-primary" onclick="updateSettings()">Update Settings</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal for Application Review -->
    <div id="reviewModal" class="modal">
        <div class="modal-content review-modal">
            <div class="modal-header">
                <h3>Review Application</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="applicationDetails"></div>
                <div class="modal-actions">
                    <button class="btn btn-success" onclick="updateApplicationStatus('approved')">Approve</button>
                    <button class="btn btn-danger" onclick="updateApplicationStatus('rejected')">Reject</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin: Student Profile Modal -->
    <div id="studentProfileModal" class="modal">
        <div class="modal-content admin-student-modal">
            <div class="modal-header">
                <h3>Student Profile</h3>
                <span class="close" onclick="closeStudentProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="admin-student-profile">
                    <!-- Left Column: Photo -->
                    <div class="admin-student-left">
                        <div class="admin-student-photo">
                            <img id="adminStudentPhoto" alt="Student ID Picture">
                        </div>
                        <div class="admin-student-photo-note">ID Picture preview</div>
                    </div>
                    
                    <!-- Middle Column: Student Info -->
                    <div class="admin-student-middle">
                        <div class="admin-student-name" id="adminStudentName"></div>
                        <div class="admin-student-meta">
                            <span id="adminStudentEmail"></span>
                            <span class="dot">•</span>
                            <span id="adminStudentId"></span>
                        </div>
                        <div class="admin-student-grid">
                            <div class="admin-student-tile">
                                <div class="label">Department</div>
                                <div class="value" id="adminStudentDepartment"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">From</div>
                                <div class="value" id="adminStudentPlace"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Course</div>
                                <div class="value" id="adminStudentCourse"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Year Level</div>
                                <div class="value" id="adminStudentYear"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Student ID</div>
                                <div class="value" id="adminStudentIdValue"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Award Number</div>
                                <div class="value" id="adminStudentAwardNumber"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Status</div>
                                <div class="value" id="adminStudentStatus"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Registered</div>
                                <div class="value" id="adminStudentRegistered"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">Indigenous People</div>
                                <div class="value" id="adminStudentIndigenous"></div>
                            </div>
                            <div class="admin-student-tile">
                                <div class="label">PWD's</div>
                                <div class="value" id="adminStudentPwd"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column: Chat -->
                    <div class="admin-student-right">
                        <div class="profile-chat-container">
                            <div class="profile-chat-header">
                                <div style="display:flex; align-items:center; gap:0.75rem;">
                                    <div class="profile-avatar" style="width:36px; height:36px;">
                                        <i class="fas fa-user-graduate" style="font-size:1rem;"></i>
                                    </div>
                                    <div>
                                        <div style="font-weight:600; line-height:1;">Chat with Student</div>
                                        <div style="font-size:0.8rem; opacity:0.9;">Direct message thread</div>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-chat-messages" id="adminStudentChatMessages">
                                <div class="chat-welcome">
                                    <div class="welcome-message">
                                        <i class="fas fa-comments"></i>
                                        <h5>Start chatting</h5>
                                        <p>Your messages will appear here.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="profile-chat-input-container">
                                <div class="profile-chat-input-wrapper">
                                    <input type="text" id="adminStudentChatInput" placeholder="Write a message..." onkeypress="adminHandleChatKeyPress(event)">
                                    <button class="profile-chat-send-btn" onclick="adminSendChatMessage()" title="Send">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="modal">
        <div class="modal-content student-registration-modal wide-modal">
            <div class="modal-header">
                <h3>Edit Student Information</h3>
                <span class="close" onclick="closeEditStudentModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editStudentForm" onsubmit="handleEditStudent(event)">
                    <input type="hidden" id="editStudentId">
                        <div class="form-grid-3">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editFirstName">First Name:</label>
                            <input type="text" id="editFirstName" required>
                        </div>
                        <div class="form-group">
                            <label for="editLastName">Last Name:</label>
                            <input type="text" id="editLastName" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editStudentIdInput">Student ID:</label>
                            <input type="text" id="editStudentIdInput" required>
                        </div>
                        <div class="form-group">
                            <label for="editEmail">Email:</label>
                            <input type="email" id="editEmail" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editDepartment">Department:</label>
                            <select id="editDepartment" required>
                                <option value="">Select Department</option>
                                <option value="Department of Computer Studies">Department of Computer Studies</option>
                                <option value="Department of Business and Management">Department of Business and Management</option>
                                <option value="Department of Industrial Technology">Department of Industrial Technology</option>
                                <option value="Department of General Teacher Training">Department of General Teacher Training</option>
                                <option value="College of Criminal Justice Education">College of Criminal Justice Education</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editPlace">From (Address/Origin):</label>
                            <input type="text" id="editPlace" placeholder="e.g., City, Province" required>
                        </div>
                    </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editCourse">Course:</label>
                                <input type="text" id="editCourse" required>
                            </div>
                            <div class="form-group">
                                <label for="editYear">Year Level:</label>
                                <select id="editYear" required>
                                    <option value="">Select Year</option>
                                    <option value="1st">1st Year</option>
                                    <option value="2nd">2nd Year</option>
                                    <option value="3rd">3rd Year</option>
                                    <option value="4th">4th Year</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editPhoto">ID Picture (optional):</label>
                                <input type="file" id="editPhoto" accept="image/*">
                                <div id="currentPhotoPreview" style="margin-top: 10px;"></div>
                            </div>
                        </div>
                        </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editIsIndigenous">INDIGENOUS PEOPLE:</label>
                            <input type="checkbox" id="editIsIndigenous">
                        </div>
                        <div class="form-group">
                            <label for="editIsPwd">PWD's:</label>
                            <input type="checkbox" id="editIsPwd">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Update Student</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditStudentModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Student Registration Modal -->
    <div id="studentRegistrationModal" class="modal">
        <div class="modal-content student-registration-modal wide-modal">
            <div class="modal-header">
                <h3>Register New Student</h3>
                <span class="close" onclick="closeStudentRegistrationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="studentRegistrationForm" onsubmit="handleStudentRegistration(event)">
                    <div class="form-grid-3">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminFirstName">First Name:</label>
                                <input type="text" id="adminFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="adminLastName">Last Name:</label>
                                <input type="text" id="adminLastName" required>
                            </div>
                            <div class="form-group">
                                <label for="adminStudentIdInput">Student ID:</label>
                                <input type="text" id="adminStudentIdInput" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminEmail">Email:</label>
                                <input type="email" id="adminEmail" required>
                            </div>
                            <div class="form-group">
                                <label for="adminAwardNumber">Award Number:</label>
                                <input type="text" id="adminAwardNumber" required placeholder="Student's unique award number">
                            </div>
                            <div class="form-group">
                                <label for="adminPassword">Password:</label>
                                <input type="password" id="adminPassword" required placeholder="Temporary password for student">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminConfirmPassword">Confirm Password:</label>
                                <input type="password" id="adminConfirmPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="adminDepartment">Department:</label>
                                <select id="adminDepartment" required>
                                    <option value="">Select Department</option>
                                    <option value="Department of Computer Studies">Department of Computer Studies</option>
                                    <option value="Department of Business and Management">Department of Business and Management</option>
                                    <option value="Department of Industrial Technology">Department of Industrial Technology</option>
                                    <option value="Department of General Teacher Training">Department of General Teacher Training</option>
                                    <option value="College of Criminal Justice Education">College of Criminal Justice Education</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="adminPlace">From (Address/Origin):</label>
                                <input type="text" id="adminPlace" placeholder="e.g., City, Province" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="adminCourse">Course:</label>
                                <input type="text" id="adminCourse" required>
                            </div>
                            <div class="form-group">
                                <label for="adminYear">Year Level:</label>
                                <select id="adminYear" required>
                                    <option value="">Select Year</option>
                                    <option value="1st">1st Year</option>
                                    <option value="2nd">2nd Year</option>
                                    <option value="3rd">3rd Year</option>
                                    <option value="4th">4th Year</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="adminPhoto">ID Picture (optional):</label>
                                <input type="file" id="adminPhoto" accept="image/*">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="adminIsIndigenous">INDIGENOUS PEOPLE:</label>
                            <input type="checkbox" id="adminIsIndigenous">
                        </div>
                        <div class="form-group">
                            <label for="adminIsPwd">PWD's:</label>
                            <input type="checkbox" id="adminIsPwd">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Register Student</button>
                        <button type="button" class="btn btn-secondary" onclick="closeStudentRegistrationModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bulk Student Registration Modal -->
    <div id="bulkRegistrationModal" class="modal">
        <div class="modal-content bulk-registration-modal">
            <div class="modal-header">
                <h3>Bulk Register Students from Excel</h3>
                <span class="close" onclick="closeBulkRegistrationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Step 1: File Upload -->
                <div id="bulkStep1" class="bulk-step active">
                    <div class="upload-section">
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h4>Upload Excel File with Student Names</h4>
                            <p>Drag and drop your Excel file here or click to browse</p>
                            <p class="file-format-info">Supported formats: .xlsx, .xls</p>
                            <input type="file" id="excelFileInput" accept=".xlsx,.xls" style="display: none;">
                            <button type="button" class="btn btn-primary" onclick="document.getElementById('excelFileInput').click()">
                                <i class="fas fa-file-excel"></i> Choose Excel File
                            </button>
                        </div>
                        <div class="file-info" id="fileInfo" style="display: none;">
                            <div class="file-details">
                                <i class="fas fa-file-excel"></i>
                                <div class="file-text">
                                    <div class="file-name" id="fileName"></div>
                                    <div class="file-size" id="fileSize"></div>
                                </div>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="removeFile()">Remove</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-primary" id="processFileBtn" onclick="processExcelFile()" disabled>
                            <i class="fas fa-cogs"></i> Extract Student Names
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeBulkRegistrationModal()">Cancel</button>
                    </div>
                </div>

                <!-- Step 2: Student Data Entry -->
                <div id="bulkStep2" class="bulk-step">
                    <div class="bulk-form-header">
                        <h4>Enter Award Numbers and Passwords</h4>
                        <p>For each student, enter their unique award number and password. Students will use these credentials to log in.</p>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions-bar">
                        <div class="quick-action-group">
                            <label for="defaultPassword">Default Password:</label>
                            <input type="password" id="defaultPassword" placeholder="e.g., student123" onchange="applyDefaultPassword()">
                            <button type="button" class="btn btn-secondary btn-sm" onclick="applyDefaultPassword()">
                                <i class="fas fa-magic"></i> Apply to All
                            </button>
                        </div>
                        <div class="quick-action-group">
                            <button type="button" class="btn btn-secondary btn-sm" onclick="generateAllAwardNumbers()">
                                <i class="fas fa-sync"></i> Generate All Award Numbers
                            </button>
                        </div>
                    </div>

                    <!-- Students List -->
                    <div class="students-section">
                        <div class="students-header">
                            <h5><i class="fas fa-users"></i> Student Accounts (<span id="studentCount">0</span> students)</h5>
                            <div class="students-summary">
                                <span class="summary-item"><i class="fas fa-check-circle text-success"></i> <span id="completedCount">0</span> Complete</span>
                                <span class="summary-item"><i class="fas fa-exclamation-circle text-warning"></i> <span id="incompleteCount">0</span> Incomplete</span>
                            </div>
                        </div>
                        
                        <div class="students-list" id="studentsList">
                            <!-- Student entries will be populated here -->
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-success btn-large" onclick="registerBulkStudents()" id="registerAllBtn" disabled>
                            <i class="fas fa-user-plus"></i> Register All Students
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="goToStep1()">
                            <i class="fas fa-arrow-left"></i> Back to Upload
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeBulkRegistrationModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="toast">
        <div class="toast-content">
            <i class="fas fa-info-circle"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    

    <!-- GranTES List Modal -->
    <div id="grantesListModal" class="modal">
        <div class="modal-content grantes-list-modal">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-title-section">
                        <i class="fas fa-graduation-cap"></i>
                        <h3>List of GranTES Students</h3>
                    </div>
                    <div class="modal-actions">
                        <span class="close" onclick="closeGrantesListModal()">&times;</span>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div class="grantes-list-container">
                    <div class="grantes-list-header">
                        <div class="search-and-filters">
                            <div class="search-container">
                                <input type="text" id="grantesSearch" placeholder="Search students by name, course, department..." onkeyup="searchGrantes()">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="filter-controls">
                                <select id="grantesStatusFilter" onchange="filterGrantesByStatus()">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                                <select id="grantesYearFilter" onchange="filterGrantesByYear()">
                                    <option value="">All Years</option>
                                    <option value="1st">1st Year</option>
                                    <option value="2nd">2nd Year</option>
                                    <option value="3rd">3rd Year</option>
                                    <option value="4th">4th Year</option>
                                </select>
                            </div>
                        </div>
                        <div class="grantes-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="totalGrantesCount">0</span>
                                <span class="stat-label">Total Students</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table Header -->
                    <div class="grantes-table-header">
                        <div class="table-header-cell name-col">
                            <span>Student Name</span>
                            <button class="sort-btn" onclick="sortGrantes('name')" title="Sort by name">
                                <i class="fas fa-sort"></i>
                            </button>
                        </div>
                        <div class="table-header-cell department-col">
                            <span>Department</span>
                            <button class="sort-btn" onclick="sortGrantes('department')" title="Sort by department">
                                <i class="fas fa-sort"></i>
                            </button>
                        </div>
                        <div class="table-header-cell course-col">
                            <span>Course</span>
                            <button class="sort-btn" onclick="sortGrantes('course')" title="Sort by course">
                                <i class="fas fa-sort"></i>
                            </button>
                        </div>
                        <div class="table-header-cell year-col">
                            <span>Year</span>
                            <button class="sort-btn" onclick="sortGrantes('year')" title="Sort by year">
                                <i class="fas fa-sort"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grantes-list-content" id="grantesListContent">
                        <!-- Student list will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <script>
        // Handle role change in login form
        function handleRoleChange() {
            const roleSelect = document.getElementById('loginRole');
            const emailGroup = document.getElementById('loginEmailGroup');
            const awardNumberGroup = document.getElementById('loginAwardNumberGroup');
            const emailInput = document.getElementById('loginEmail');
            const awardNumberInput = document.getElementById('loginAwardNumber');
            
            if (roleSelect.value === 'student') {
                // Show award number field, hide email field
                emailGroup.style.display = 'none';
                awardNumberGroup.style.display = 'block';
                emailInput.required = false;
                awardNumberInput.required = true;
            } else if (roleSelect.value === 'admin') {
                // Show email field, hide award number field
                emailGroup.style.display = 'block';
                awardNumberGroup.style.display = 'none';
                emailInput.required = true;
                awardNumberInput.required = false;
            } else {
                // Hide both fields when no role is selected
                emailGroup.style.display = 'block';
                awardNumberGroup.style.display = 'none';
                emailInput.required = false;
                awardNumberInput.required = false;
            }
        }

        // Initialize the form on page load
        document.addEventListener('DOMContentLoaded', function() {
            handleRoleChange();
        });

        // Filter updates by category
        function filterUpdates(category) {
            const items = document.querySelectorAll('.update-item');
            const tabs = document.querySelectorAll('.updates-announcements-tabs .tab-btn');
            
            // Update active tab
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Filter items
            items.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Student Registration Functions
        function openStudentRegistrationModal() {
            document.getElementById('studentRegistrationModal').style.display = 'block';
            // Clear form
            document.getElementById('studentRegistrationForm').reset();
        }

        function closeStudentRegistrationModal() {
            document.getElementById('studentRegistrationModal').style.display = 'none';
        }

        function handleStudentRegistration(event) {
            event.preventDefault();
            
            const formData = {
                firstName: document.getElementById('adminFirstName').value,
                lastName: document.getElementById('adminLastName').value,
                studentId: document.getElementById('adminStudentIdInput').value,
                email: document.getElementById('adminEmail').value,
                awardNumber: document.getElementById('adminAwardNumber').value,
                password: document.getElementById('adminPassword').value,
                confirmPassword: document.getElementById('adminConfirmPassword').value,
                course: document.getElementById('adminCourse').value,
                year: document.getElementById('adminYear').value
            };

            // Validate passwords match
            if (formData.password !== formData.confirmPassword) {
                showNotification('Passwords do not match!', 'error');
                return;
            }

            // Validate password strength
            if (formData.password.length < 6) {
                showNotification('Password must be at least 6 characters long!', 'error');
                return;
            }

            // Check if student already exists (in a real app, this would be a server call)
            const existingStudents = JSON.parse(localStorage.getItem('students') || '[]');
            const existingStudent = existingStudents.find(s => 
                s.studentId === formData.studentId || 
                s.email === formData.email || 
                s.awardNumber === formData.awardNumber
            );

            if (existingStudent) {
                showNotification('Student with this ID, email, or award number already exists!', 'error');
                return;
            }

            // Create student object
            const newStudent = {
                id: Date.now(),
                firstName: formData.firstName,
                lastName: formData.lastName,
                studentId: formData.studentId,
                email: formData.email,
                awardNumber: formData.awardNumber,
                password: formData.password, // In production, this should be hashed
                course: formData.course,
                year: formData.year,
                status: 'active',
                applicationStatus: 'none',
                registeredDate: new Date().toISOString(),
                isAdminCreated: true
            };

            // Save to localStorage (in production, this would be a server call)
            existingStudents.push(newStudent);
            localStorage.setItem('students', JSON.stringify(existingStudents));

            // Update admin dashboard stats
            updateAdminStats();

            // Show success message
            showNotification(`Student ${formData.firstName} ${formData.lastName} registered successfully! Award Number: ${formData.awardNumber}`, 'success');

            // Close modal and reset form
            closeStudentRegistrationModal();
        }

        function showNotification(message, type = 'info') {
            const toast = document.getElementById('notificationToast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 5000);
        }

        function updateAdminStats() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const totalStudents = students.length;
            // As requested, Indigenous People count is fixed to 0
            const approvedStudents = students.filter(s => s.isIndigenous).length;
            const pendingStudents = students.filter(s => s.isPwd).length;
            const archivedStudents = students.filter(s => s.status === 'archived').length;

            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('totalApproved').textContent = approvedStudents;
            document.getElementById('totalPending').textContent = pendingStudents;
            document.getElementById('totalArchived').textContent = archivedStudents;
        }

        // Bulk Registration Functions
        let uploadedFile = null;
        let extractedStudents = [];

        function openBulkRegistrationModal() {
            document.getElementById('bulkRegistrationModal').style.display = 'block';
            resetBulkModal();
        }

        function closeBulkRegistrationModal() {
            document.getElementById('bulkRegistrationModal').style.display = 'none';
            resetBulkModal();
        }

        function resetBulkModal() {
            // Reset to step 1
            document.getElementById('bulkStep1').classList.add('active');
            document.getElementById('bulkStep2').classList.remove('active');
            
            // Clear file
            uploadedFile = null;
            extractedStudents = [];
            document.getElementById('excelFileInput').value = '';
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('processFileBtn').disabled = true;
            
            // Clear form
            document.getElementById('defaultCourse').value = '';
            document.getElementById('defaultYear').value = '';
            document.getElementById('defaultPassword').value = '';
            document.getElementById('studentsList').innerHTML = '';
        }

        function goToStep1() {
            document.getElementById('bulkStep1').classList.add('active');
            document.getElementById('bulkStep2').classList.remove('active');
        }

        function goToStep2() {
            document.getElementById('bulkStep1').classList.remove('active');
            document.getElementById('bulkStep2').classList.add('active');
        }

        // File upload handling
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('excelFileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            if (fileInput && uploadArea) {
                // Click to upload
                uploadArea.addEventListener('click', () => {
                    fileInput.click();
                });

                // File selection
                fileInput.addEventListener('change', handleFileSelect);

                // Drag and drop
                uploadArea.addEventListener('dragover', handleDragOver);
                uploadArea.addEventListener('dragleave', handleDragLeave);
                uploadArea.addEventListener('drop', handleDrop);
            }
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function processFile(file) {
            // Validate file type
            const validTypes = [
                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx
                'application/vnd.ms-excel' // .xls
            ];
            
            if (!validTypes.includes(file.type)) {
                showNotification('Please upload a valid Excel file (.xlsx or .xls)', 'error');
                return;
            }

            uploadedFile = file;
            
            // Show file info
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('uploadArea').style.display = 'none';
            document.getElementById('fileInfo').style.display = 'block';
            document.getElementById('processFileBtn').disabled = false;
        }

        function removeFile() {
            uploadedFile = null;
            document.getElementById('excelFileInput').value = '';
            document.getElementById('uploadArea').style.display = 'block';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('processFileBtn').disabled = true;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function processExcelFile() {
            if (!uploadedFile) {
                showNotification('Please select a file first', 'error');
                return;
            }

            // For demo purposes, we'll simulate Excel parsing
            // In a real implementation, you would use a library like SheetJS
            showNotification('Processing Excel file...', 'info');
            
            // Simulate processing delay
            setTimeout(() => {
                // Mock data - in real implementation, parse actual Excel file
                extractedStudents = [
                    { firstName: 'John', lastName: 'Doe' },
                    { firstName: 'Jane', lastName: 'Smith' },
                    { firstName: 'Michael', lastName: 'Johnson' },
                    { firstName: 'Sarah', lastName: 'Williams' },
                    { firstName: 'David', lastName: 'Brown' },
                    { firstName: 'Emily', lastName: 'Davis' },
                    { firstName: 'Christopher', lastName: 'Miller' },
                    { firstName: 'Jessica', lastName: 'Wilson' }
                ];
                
                populateStudentsList();
                goToStep2();
                showNotification(`Successfully extracted ${extractedStudents.length} students from Excel file`, 'success');
            }, 1500);
        }

        function populateStudentsList() {
            const container = document.getElementById('studentsList');
            const defaultCourse = document.getElementById('defaultCourse').value;
            const defaultYear = document.getElementById('defaultYear').value;
            const defaultPassword = document.getElementById('defaultPassword').value;

            container.innerHTML = extractedStudents.map((student, index) => `
                <div class="student-entry" data-index="${index}">
                    <div class="student-name">
                        <i class="fas fa-user"></i>
                        ${student.firstName} ${student.lastName}
                    </div>
                    <input type="text" placeholder="Award Number" class="award-number-input" 
                           value="${generateAwardNumber(index)}" required
                           onchange="validateStudentEntry(${index})" oninput="updateStudentSummary()">
                    <input type="password" placeholder="Password" class="password-input" 
                           value="${defaultPassword}" required
                           onchange="validateStudentEntry(${index})" oninput="updateStudentSummary()">
                    <button type="button" class="remove-student-btn" onclick="removeStudent(${index})" title="Remove student">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
            
            updateStudentSummary();
        }

        function generateAwardNumber(index) {
            // Generate a unique award number
            const year = new Date().getFullYear();
            const paddedIndex = String(index + 1).padStart(3, '0');
            return `AW${year}${paddedIndex}`;
        }

        function removeStudent(index) {
            if (confirm(`Are you sure you want to remove ${extractedStudents[index].firstName} ${extractedStudents[index].lastName}?`)) {
                extractedStudents.splice(index, 1);
                populateStudentsList();
            }
        }

        function applyDefaultsToAll() {
            const defaultCourse = document.getElementById('defaultCourse').value;
            const defaultYear = document.getElementById('defaultYear').value;
            const defaultPassword = document.getElementById('defaultPassword').value;

            // Apply defaults to all student entries
            document.querySelectorAll('.student-entry').forEach((entry, index) => {
                const courseInput = entry.querySelector('.course-input');
                const yearInput = entry.querySelector('.year-input');
                const passwordInput = entry.querySelector('.password-input');
                
                if (courseInput && defaultCourse) courseInput.value = defaultCourse;
                if (yearInput && defaultYear) yearInput.value = defaultYear;
                if (passwordInput && defaultPassword) passwordInput.value = defaultPassword;
            });

            updateStudentSummary();
        }

        function validateStudentEntry(index) {
            const entry = document.querySelector(`[data-index="${index}"]`);
            const awardNumberInput = entry.querySelector('.award-number-input');
            const passwordInput = entry.querySelector('.password-input');
            
            let isValid = true;
            
            // Clear previous error states
            awardNumberInput.classList.remove('error');
            passwordInput.classList.remove('error');
            entry.classList.remove('complete', 'incomplete');
            
            // Validate award number
            if (!awardNumberInput.value.trim()) {
                awardNumberInput.classList.add('error');
                isValid = false;
            } else {
                // Check for duplicates
                const allAwardNumbers = Array.from(document.querySelectorAll('.award-number-input'))
                    .map(input => input.value.trim())
                    .filter((value, i) => value && i !== index);
                
                if (allAwardNumbers.includes(awardNumberInput.value.trim())) {
                    awardNumberInput.classList.add('error');
                    isValid = false;
                }
            }
            
            // Validate password
            if (!passwordInput.value.trim() || passwordInput.value.trim().length < 6) {
                passwordInput.classList.add('error');
                isValid = false;
            }
            
            // Update entry status
            if (isValid) {
                entry.classList.add('complete');
            } else {
                entry.classList.add('incomplete');
            }
            
            return isValid;
        }

        function updateStudentSummary() {
            const totalStudents = extractedStudents.length;
            const completedStudents = Array.from(document.querySelectorAll('.student-entry'))
                .filter(entry => entry.classList.contains('complete')).length;
            const incompleteStudents = totalStudents - completedStudents;
            
            document.getElementById('studentCount').textContent = totalStudents;
            document.getElementById('completedCount').textContent = completedStudents;
            document.getElementById('incompleteCount').textContent = incompleteStudents;
            
            // Enable/disable register button
            const registerBtn = document.getElementById('registerAllBtn');
            if (completedStudents === totalStudents && totalStudents > 0) {
                registerBtn.disabled = false;
                registerBtn.innerHTML = `<i class="fas fa-user-plus"></i> Register All ${totalStudents} Students`;
            } else {
                registerBtn.disabled = true;
                registerBtn.innerHTML = `<i class="fas fa-user-plus"></i> Register All Students (${incompleteStudents} incomplete)`;
            }
        }

        function registerBulkStudents() {
            const defaultCourse = document.getElementById('defaultCourse').value;
            const defaultYear = document.getElementById('defaultYear').value;
            
            if (!defaultCourse || !defaultYear) {
                showNotification('Please fill in default course and year level', 'error');
                return;
            }

            const studentsToRegister = [];
            const errors = [];

            // Validate all entries first
            let allValid = true;
            document.querySelectorAll('.student-entry').forEach((entry, index) => {
                if (!validateStudentEntry(index)) {
                    allValid = false;
                }
            });

            if (!allValid) {
                showNotification('Please fix all validation errors before registering students', 'error');
                return;
            }

            // Collect student data
            document.querySelectorAll('.student-entry').forEach((entry, index) => {
                const awardNumber = entry.querySelector('.award-number-input').value.trim();
                const password = entry.querySelector('.password-input').value.trim();
                const student = extractedStudents[index];

                studentsToRegister.push({
                    firstName: student.firstName,
                    lastName: student.lastName,
                    studentId: `STU${String(index + 1).padStart(4, '0')}`,
                    email: `${student.firstName.toLowerCase()}.${student.lastName.toLowerCase()}@student.edu`,
                    awardNumber: awardNumber,
                    password: password,
                    course: defaultCourse,
                    year: defaultYear,
                    status: 'active',
                    applicationStatus: 'none',
                    registeredDate: new Date().toISOString(),
                    isAdminCreated: true
                });
            });

            // Register all students
            const existingStudents = JSON.parse(localStorage.getItem('students') || '[]');
            studentsToRegister.forEach(student => {
                existingStudents.push(student);
            });
            
            localStorage.setItem('students', JSON.stringify(existingStudents));
            
            // Update admin dashboard stats
            updateAdminStats();
            
            showNotification(`Successfully registered ${studentsToRegister.length} students! They can now log in using their award numbers and passwords.`, 'success');
            closeBulkRegistrationModal();
        }

        // GranTES List Functions
        function showGrantesList() {
            document.getElementById('grantesListModal').style.display = 'block';
            loadGrantesList();
        }

        function closeGrantesListModal() {
            document.getElementById('grantesListModal').style.display = 'none';
        }

        // Global variables for sorting and filtering
        let currentSortField = 'name';
        let currentSortDirection = 'asc';
        let filteredStudents = [];

        function loadGrantesList() {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const container = document.getElementById('grantesListContent');
            const totalCountElement = document.getElementById('totalGrantesCount');
            
            // Apply current filters
            filteredStudents = applyFilters(students);
            
            // Update statistics
            totalCountElement.textContent = students.length;
            
            if (filteredStudents.length === 0) {
                container.innerHTML = `
                    <div class="no-grantes">
                        <i class="fas fa-users"></i>
                        <h4>No Students Found</h4>
                        <p>${students.length === 0 ? 'No GranTES students have been registered yet.' : 'No students match your current filters.'}</p>
                    </div>
                `;
                return;
            }

            // Sort the filtered students
            const sortedStudents = sortStudents(filteredStudents, currentSortField, currentSortDirection);

            container.innerHTML = sortedStudents.map(student => `
                <div class="grantes-student-item" 
                     data-name="${student.firstName} ${student.lastName}" 
                     data-course="${student.course}" 
                     data-year="${student.year}" 
                     data-department="${student.department || ''}"
                     data-status="${student.applicationStatus || 'active'}"
                     data-email="${student.email || ''}"
                     data-award="${student.awardNumber || ''}">
                    <div class="grantes-student-name">
                        <i class="fas fa-user-graduate"></i>
                        <div>
                            <div>${student.firstName} ${student.lastName}</div>
                            <div style="font-size: 0.75rem; color: #64748b; font-weight: 400;">
                                ${student.email || student.awardNumber || 'No contact info'}
                            </div>
                        </div>
                    </div>
                    <div class="grantes-student-info">
                        <div class="grantes-student-department">${student.department || 'Not specified'}</div>
                    </div>
                    <div class="grantes-student-info">
                        <div class="grantes-student-course">${student.course || 'Not specified'}</div>
                    </div>
                    <div class="grantes-student-info">
                        <div class="grantes-student-year">${student.year || 'N/A'} Year</div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusText(status) {
            switch(status) {
                case 'approved': return 'Approved';
                case 'pending': return 'Pending';
                case 'rejected': return 'Rejected';
                default: return 'Active';
            }
        }

        function applyFilters(students) {
            const searchTerm = (document.getElementById('grantesSearch')?.value || '').trim().toLowerCase();
            const statusFilter = document.getElementById('grantesStatusFilter')?.value || '';
            const yearFilter = document.getElementById('grantesYearFilter')?.value || '';
            
            return students.filter(student => {
                const matchesSearch = !searchTerm || 
                    (student.firstName || '').toLowerCase().includes(searchTerm) ||
                    (student.lastName || '').toLowerCase().includes(searchTerm) ||
                    (student.email || '').toLowerCase().includes(searchTerm) ||
                    (student.awardNumber || '').toLowerCase().includes(searchTerm) ||
                    (student.course || '').toLowerCase().includes(searchTerm) ||
                    (student.department || '').toLowerCase().includes(searchTerm) ||
                    (student.year || '').toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || (student.applicationStatus || 'active') === statusFilter;
                const matchesYear = !yearFilter || (student.year || '').toLowerCase().includes(yearFilter.toLowerCase());
                
                return matchesSearch && matchesStatus && matchesYear;
            });
        }

        function sortStudents(students, field, direction) {
            return [...students].sort((a, b) => {
                let aValue, bValue;
                
                switch(field) {
                    case 'name':
                        aValue = `${a.firstName} ${a.lastName}`.toLowerCase();
                        bValue = `${b.firstName} ${b.lastName}`.toLowerCase();
                        break;
                    case 'department':
                        aValue = (a.department || '').toLowerCase();
                        bValue = (b.department || '').toLowerCase();
                        break;
                    case 'course':
                        aValue = (a.course || '').toLowerCase();
                        bValue = (b.course || '').toLowerCase();
                        break;
                    case 'status':
                        aValue = (a.applicationStatus || 'active').toLowerCase();
                        bValue = (b.applicationStatus || 'active').toLowerCase();
                        break;
                    default:
                        aValue = (a[field] || '').toString().toLowerCase();
                        bValue = (b[field] || '').toString().toLowerCase();
                }
                
                if (aValue < bValue) return direction === 'asc' ? -1 : 1;
                if (aValue > bValue) return direction === 'asc' ? 1 : -1;
                return 0;
            });
        }

        function sortGrantes(field) {
            if (currentSortField === field) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortField = field;
                currentSortDirection = 'asc';
            }
            
            // Update sort button icons
            document.querySelectorAll('.sort-btn i').forEach(icon => {
                icon.className = 'fas fa-sort';
            });
            
            const currentSortBtn = document.querySelector(`[onclick="sortGrantes('${field}')"] i`);
            if (currentSortBtn) {
                currentSortBtn.className = currentSortDirection === 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down';
            }
            
            loadGrantesList();
        }

        function filterGrantesByStatus() {
            loadGrantesList();
        }

        function filterGrantesByYear() {
            loadGrantesList();
        }

        function searchGrantes() {
            loadGrantesList();
        }

        function viewStudentProfile(studentId) {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const student = students.find(s => s.id == studentId);
            
            if (student) {
                // Create a detailed profile modal or navigate to student details
                const profileInfo = `
                    <div style="padding: 1rem; background: white; border-radius: 8px; margin: 1rem 0;">
                        <h3 style="color: #1e293b; margin-bottom: 1rem;">
                            <i class="fas fa-user-graduate" style="color: #667eea; margin-right: 0.5rem;"></i>
                            ${student.firstName} ${student.lastName}
                        </h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                            <div><strong>Email:</strong> ${student.email || 'Not provided'}</div>
                            <div><strong>Award Number:</strong> ${student.awardNumber || 'Not provided'}</div>
                            <div><strong>Student ID:</strong> ${student.studentId || 'Not provided'}</div>
                            <div><strong>Course:</strong> ${student.course || 'Not provided'}</div>
                            <div><strong>Year:</strong> ${student.year || 'Not provided'}</div>
                            <div><strong>Department:</strong> ${student.department || 'Not provided'}</div>
                            <div><strong>Status:</strong> 
                                <span class="grantes-student-status ${student.applicationStatus || 'active'}">
                                    ${getStatusText(student.applicationStatus)}
                                </span>
                            </div>
                            <div><strong>Registration Date:</strong> ${student.registrationDate || 'Not available'}</div>
                        </div>
                    </div>
                `;
                
                // You could show this in a modal or alert
                alert(`Student Profile:\n\n${student.firstName} ${student.lastName}\nEmail: ${student.email || 'Not provided'}\nAward Number: ${student.awardNumber || 'Not provided'}\nCourse: ${student.course || 'Not provided'}\nYear: ${student.year || 'Not provided'}\nDepartment: ${student.department || 'Not provided'}\nStatus: ${getStatusText(student.applicationStatus)}`);
            } else {
                showToast('Student not found', 'error');
            }
        }

        function sendMessageToStudent(studentId) {
            const students = JSON.parse(localStorage.getItem('students') || '[]');
            const student = students.find(s => s.id == studentId);
            
            if (student) {
                // Open chat and focus on input
                if (typeof openChat === 'function') {
                    openChat();
                    // Focus on chat input after a short delay
                    setTimeout(() => {
                        const chatInput = document.getElementById('chatInput');
                        if (chatInput) {
                            chatInput.focus();
                            chatInput.value = `@${student.firstName} ${student.lastName} `;
                        }
                    }, 300);
                } else {
                    showToast('Chat feature not available', 'warning');
                }
            } else {
                showToast('Student not found', 'error');
            }
        }


        // Close modal when clicking outside
        window.onclick = function(event) {
            const grantesModal = document.getElementById('grantesListModal');
            if (event.target === grantesModal) {
                closeGrantesListModal();
            }
        }

        // Enhanced Admin Homepage Functions
        let posts = JSON.parse(localStorage.getItem('adminPosts') || '[]');

        // Handle audience selection change
        function handleAudienceChange() {
            const audienceSelect = document.getElementById('postAudience');
            const courseSelect = document.getElementById('postCourse');
            
            if (audienceSelect.value === 'specific') {
                courseSelect.style.display = 'block';
            } else {
                courseSelect.style.display = 'none';
            }
        }

        // Handle post key press
        function handlePostKeyPress(event) {
            if (event.key === 'Enter') {
                publishPost();
            }
        }

        // Create post function
        function createPost(type) {
            const postInput = document.getElementById('postInput');
            const audience = document.getElementById('postAudience').value;
            const course = document.getElementById('postCourse').value;
            
            if (!postInput.value.trim()) {
                showNotification('Please enter a message before posting', 'error');
                return;
            }

            const newPost = {
                id: Date.now(),
                content: postInput.value,
                type: type,
                audience: audience,
                course: course,
                author: 'Administrator',
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: []
            };

            posts.unshift(newPost);
            localStorage.setItem('adminPosts', JSON.stringify(posts));
            
            // Clear input
            postInput.value = '';
            document.getElementById('postAudience').value = 'students';
            document.getElementById('postCourse').style.display = 'none';
            
            // Refresh posts feed
            loadPostsFeed();
            
            showNotification('Post published successfully!', 'success');
        }

        // Publish post function
        function publishPost() {
            createPost('text');
        }

        // loadPostsFeed function removed - using the one from script.js instead

        // Post action functions removed - using the ones from script.js instead

        // Initialize admin homepage
        function initializeAdminHomepage() {
            loadAdminPosts(); // Use the function from script.js
            
            // Add event listener for audience change
            const audienceSelect = document.getElementById('postAudience');
            if (audienceSelect) {
                audienceSelect.addEventListener('change', handleAudienceChange);
            }
        }

        // Initialize when admin dashboard loads
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're on admin dashboard and initialize
            if (document.getElementById('admin-homepage')) {
                initializeAdminHomepage();
            }
        });
    </script>
    <script src="script.js"></script>
    
    <!-- Auto-expand textareas functionality -->
    <script>
        // Auto-expand textareas when typing
        function autoExpandTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
        }

        // Add event listeners to all textareas for auto-expansion
        document.addEventListener('DOMContentLoaded', function() {
            // Function to add auto-expand to textareas
            function addAutoExpandToTextareas() {
                const textareas = document.querySelectorAll('textarea');
                textareas.forEach(textarea => {
                    // Remove existing listeners to avoid duplicates
                    textarea.removeEventListener('input', textarea.autoExpandHandler);
                    
                    // Create new handler
                    textarea.autoExpandHandler = function() {
                        autoExpandTextarea(this);
                    };
                    
                    // Add the event listener
                    textarea.addEventListener('input', textarea.autoExpandHandler);
                    
                    // Set initial height
                    autoExpandTextarea(textarea);
                });
            }
            
            // Add auto-expand to existing textareas
            addAutoExpandToTextareas();
            
            // Watch for new textareas added dynamically
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1) { // Element node
                                if (node.tagName === 'TEXTAREA') {
                                    node.autoExpandHandler = function() {
                                        autoExpandTextarea(this);
                                    };
                                    node.addEventListener('input', node.autoExpandHandler);
                                    autoExpandTextarea(node);
                                }
                                // Check for textareas within added nodes
                                const textareas = node.querySelectorAll ? node.querySelectorAll('textarea') : [];
                                textareas.forEach(textarea => {
                                    textarea.autoExpandHandler = function() {
                                        autoExpandTextarea(this);
                                    };
                                    textarea.addEventListener('input', textarea.autoExpandHandler);
                                    autoExpandTextarea(textarea);
                                });
                            }
                        });
                    }
                });
            });
            
            // Start observing
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        });
    </script>
</body>
</html>
